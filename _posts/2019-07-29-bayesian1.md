---
title: 'Bayesian Methods and Molecular Modelling 1'
date: 2019-07-29
permalink: /posts/2019/07/bayesian1/
tags:
  - molecularModelling
  - scientificComputing
---
(Last updated: 2019-07-29). This is an ongoing post as I work through a tutorial I found.

# Introduction
Within the world of molecular modelling, a very exciting group is doing some 
interesting work. They are the 
[OpenForceField consortium](https://openforcefield.org/).
Looking through one of their 
[workshops](https://openforcefield.org/news/jan-2019-meeting-agenda/),
they draw some interesting analogies between 
*developing force fields and bayesian inference*.
As someone *transitioning from molecular modelling to data science*, this is 
certainly an interesting intersection.

## A big question
*Given some thermodynamic/QM data, how can we best parametrize force fields?*

Let's step back a bit and make it sound more statistics-y.

*Given some energetic data, how can we best model the energy of a system? 
What is the best distribution/equation to model the energy (aka force field)? 
And what are the best distributions to describe the parameters of the model?
From these fitted/parametrized models, can we interpret anything from them
Can we sample/simulate anything from them?*

# Learning some Bayesian methods
Here's where I stumble through miscellaneous talks, lectures, publications,
and tutorials to try to piece together bits of this field.
I found a particularly interesting tutorial by [Chris Fonnesbeck](https://github.com/fonnesbeck/mcmc_pydata_london_2019)

**Important**: I am *really* hoping someone out there is reading this and 
will correct me where I am wrong. I've learned solo-learning 
can be trial-and-error, and having external input can be very invaluable
for guiding education.

## Notebook 1: Introduction to PyMC3
Their example is studying radon levels (actually, log(radon)) in households, 
developing a model, 
and trying to identify how many households are greather than a threshold.

* We are interested in the **posterior distribution** given the data
* To develop a **sampling distribution** for the data, 
they use a *normal distribution*, which requires parameters for $\mu$ and $\sigma$,
and also is based on an **observed distribution** (the gathered data)
* To develop a **model or distribution for $\mu$**, they first approximate/guess
with a *normal distribution* (it's okay if the log radon is negative)
* To develop a **model or distribution for $\sigma$**, they first approximate/guess
with a *uniform distribution* (standard deviations and variances shouldn't 
be negative)

In actuality, first the models for $\mu$ and $\sigma$ came first,
THEN the sampling distribution for the data was built off the $\mu$ and $\sigma$ 
distributions in addition to the observed data

The overarching model was fit using a **Markov chain Monte Carlo** (MCMC) method.

After fitting the model we can observe some probabilities about a point estimate,
$\mu$:

* Probability that the mean level of radon is *above* a threshold
* Probability that the mean level of radon is *below* a threshold

### Translation to molecular modelling
* Our **posterior distribution** is the force field (potential energy function)
given some observable. Analogously, this was the posterior distribution of radon
levels given the observed data.

* In our molecular model, let's say we just model the force field 
as harmonic springs 
![Harmonic spring](/images/mm/harmonicspring.png). Here, the two parameters
are $k$ and $r_0$
* In the radon model, we modelled with a normal distribution. There, the two 
parameters were $\mu$ and $\sigma$
* We used normal distributions for $\mu$ and $\sigma$. For $k$ and $r_0$, we know
they should be non-negative (force constants and equilibrium lengths, 
respectively, are physically and generally non-negative), but we could
use some sort of distribution that won't get us negatives

At this point in both cases:

* We have an equation that expresses either our energy 
or the radon level (force field, posterior distribution). 
* We have also identified the associated parameters
in these equations ($k$ & $r_0$, $\mu$ & $\sigma$). 
* For these parameters, we are estimating/approximating them via some 
other equation or distribution (normal or uniform)

The next step is to fit the model using some sort of sampling method. 
Molecular modellers would call this parametrization.
In layman's terms, I think this means some sophisticated guess-and-check or
numerical optimization method to get the parameters 
that well-describe the observed data.

Now we have our parameters, so we can sample from this model or distribution 
(simulating, sampling), and see how well the simulated/sampled data
recreates the generated data.

We can interpret these models: make some statements about the 
mean radon model or make some statements about the equilibrium bond length

Lastly, sensitivity analysis means messing with the underlying assumptions -
what if we didn't use normal/uniform distributions to describe [$k$, $r_0$] or
[$\mu$, $\sigma$]? I think you could go one step further and mess
with the underlying model, what if the radon level wasn't modelled as a 
normal distribution? 
What if the force field wasn't modelled as harmonic spring bonds?

I would hazard a guess and say not to try radically different models if they
intuitively don't really describe the data we are interested in modelling -
modelling a force field (energy) as a purely random distribution would probably 
be a physically-unrealistic model and would not describe your data well.
